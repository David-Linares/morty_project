<!DOCTYPE html>
<html lang="es">
{% load static %}
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, shrink-to-fit=no">
    <title>..::ASEMI::..</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
</head>
<body onload="mostrar_alert()">
<div class="container">
{#    Contenedor del Header Donde están los nombres y los logos  #}
    <div class="row">
        <div class="col-xs-12 col-sm-8">
            <p style="text-align: center">
                <label style="font-size: 25px" tabindex="1">ASEMI</label><br/>
                <label style="text-align: center; line-height: 30%; font-weight: normal" tabindex="2">Proyecto de grado</label><br/>
                <label style="text-align: center; line-height: 30%; font-weight: normal" tabindex="3">Desarrollado por: Ximena Garzón y Daniel Beltrán</label><br/>
                <label style="text-align: center; line-height: 30%; font-weight: normal" tabindex="4">Director: Ingeniero Mario Silva</label><br/>
                <label style="text-align: center; line-height: 30%; font-weight: normal" tabindex="5">Programa Ingeniería de Sistemas</label><br/>
            </p>
        </div>
        <div class="col-xs-12 col-sm-4">
            <img src="{% static "img/uelbosque.jpg" %}" alt="Logo U El Bosque" width="58%" tabindex="6">
            <img src="{% static "img/inci.jpg" %}" alt="Logo INCI" width="27%" tabindex="7">
        </div>
    </div>
    <div class="row">
        <div class="col-sm-8 col-xs-12">
            <label style="font-size: 24px" tabindex="8">Escriba ecuación en lenguaje Latex</label>
            <form action="/" method="post">
                {% csrf_token %}
                <textarea name="latex_form" style="border: 1px solid #777777; width: 90%; height: 250px" tabindex="9" id="ta_latex">{{ latex_form }}</textarea>
                <input type="submit" value="Graficar Ecuación" alt="Graficar Ecuación" class="btn btn-success" tabindex="10">
{#                <input type="submit" value="Cargar Ecuación" alt="Cargar Ecuación" class="btn btn-info" tabindex="11">#}
            </form>
            <br>
            <div class="col-sm-12 col-xs-12">
                <label style="font-size:24px" tabindex="12">Ecuación Gráfica</label>
                <div class="col-sm-8" style="min-height: 150px; min-width: 90%; font-size: 30px">
                    {% for math in mathml_data %}
                        <div class="col-sm-4">
                        {% with y=forloop.counter0|stringformat:"i" %}
                        {% with val_sound="last_record"|add:y|add:".ogg" %}
                            <input type="hidden" name="sound_name{{ y }}" id="sound_name{{ y }}" value="{% static val_sound %}">
                            <input type="button" value="Leer Ecuación {{ y|add:"1"}}" alt="Leer Ecuación {{ y|add:"1"}}" class="btn btn-success" tabindex="14" onclick="play_sound('sound_name{{ y }}')">
                {#            <img src="https://nomeloexplicaron.files.wordpress.com/2015/05/bloc-de-notas.png" alt="Guardar expresión en archivo" height="100px" class="btn" tabindex="16">#}
                        {% endwith %}
                        {% endwith %}
                        </div>
                        <div editable="true" readonly tabindex="14">{{ math | safe }}</div>
                        <br>
                    {% endfor %}
                </div>
                <form action="/export/" method="POST" target="_blank">
                    <input type="hidden" value="{{ mathml_data }}" name="data_mathml">
                    {% csrf_token %}
                    <button><img src="{% static "img/pdf.png" %}" alt="Exportar ecuación a archivo PDF" height="70px" class="btn" tabindex="15"></button>
                </form>
                <br>
            </div>
        </div>
        <div class="col-sm-4 col-xs-12" style="margin-top: 4%">
            <table border="1" bordercolor="#447e9b">
                {% for sym in data_symbols %}
                    {% if forloop.counter0|divisibleby:4 %}
                        {% if forloop.counter0 > 0 %}
                            </tr>
                        {% endif %}
                        <tr align="center">
                        <td><button class="btn" style="background: none" latexval="{{ sym.1 }}" cursorpos="{{ sym.2 }}" onclick="setfunction(this)"><img src="{% static sym.3 %}" width="{{ sym.6 }}" alt="{{ sym.4 }}"></button></td>
                    {% endif %}
                    {% if not forloop.counter0|divisibleby:4 %}
                        <td><button class="btn" style="background: none" latexval="{{ sym.1 }}" cursorpos="{{ sym.2 }}" onclick="setfunction(this)"><img src="{% static sym.3 %}" width="{{ sym.6 }}" alt="{{ sym.4 }}"></button></td>
                    {% endif %}
                {% endfor %}
            </table>
{#            <button class="btn" style="background: none" latexval="\frac{}{}" cursorpos="6" onclick="setfunction(this)"><img src="{% static "img/fraccion.png" %}" height="40px" alt="fraccion"></button>#}
{#            <button class="btn" style="background: none" latexval="\sin" cursorpos="5" onclick="setfunction(this)"><img src="{% static "img/sin.png" %}" height="40px" alt="Función Seno"></button>#}
{#            <button class="btn" style="background: none" latexval="\cos" cursorpos="5" onclick="setfunction(this)"><img src="{% static "img/cos.png" %}" height="40px" alt="Función Coseno"></button>#}
{#            <button class="btn" style="background: none" latexval="\frac{}{}" cursorpos="6" onclick="setfunction(this)"><img src="{% static "img/fraccion.png" %}" height="40px" alt="fraccion"></button>#}
{#            <button class="btn" style="background: none" latexval="\frac{}{}" cursorpos="6" onclick="setfunction(this)"><img src="{% static "img/fraccion.png" %}" height="40px" alt="fraccion"></button>#}
{#            <button class="btn" style="background: none" latexval="\frac{}{}" cursorpos="6" onclick="setfunction(this)"><img src="{% static "img/fraccion.png" %}" height="40px" alt="fraccion"></button>#}
{#            <button class="btn" style="background: none" latexval="\frac{}{}" cursorpos="6" onclick="setfunction(this)"><img src="{% static "img/fraccion.png" %}" height="40px" alt="fraccion"></button>#}
{#            <button class="btn" style="background: none" latexval="\frac{}{}" cursorpos="6" onclick="setfunction(this)"><img src="{% static "img/fraccion.png" %}" height="40px" alt="fraccion"></button>#}
{#            <button class="btn" style="background: none" latexval="\frac{}{}" cursorpos="6" onclick="setfunction(this)"><img src="{% static "img/fraccion.png" %}" height="40px" alt="fraccion"></button>#}
{#            <button class="btn" style="background: none" latexval="\frac{}{}" cursorpos="6" onclick="setfunction(this)"><img src="{% static "img/fraccion.png" %}" height="40px" alt="fraccion"></button>#}
{#            <button class="btn" style="background: none" latexval="\frac{}{}" cursorpos="6" onclick="setfunction(this)"><img src="{% static "img/fraccion.png" %}" height="40px" alt="fraccion"></button>#}
{#            <button class="btn" style="background: none" latexval="\frac{}{}" cursorpos="6" onclick="setfunction(this)"><img src="{% static "img/fraccion.png" %}" height="40px" alt="fraccion"></button>#}
{#            <button class="btn" style="background: none" latexval="\frac{}{}" cursorpos="6" onclick="setfunction(this)"><img src="{% static "img/fraccion.png" %}" height="40px" alt="fraccion"></button>#}
        </div>
    </div>
    <div class="row">

    </div>
</div>
</body>
<script type="text/javascript" async
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML">
</script>
<script
  src="https://code.jquery.com/jquery-3.2.1.min.js"
  integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
  crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script src="{% static "main/js/script.js" %}"></script>
<script type="application/javascript">
    function play_sound(sound){
        console.log(sound)
        sound_name = document.getElementById(sound);
        var snd = new Audio(sound_name.value);
        snd.play();
    }

    function mostrar_alert(){
        sound_name = document.getElementById("sound_name0");
        if (sound_name != null) {
            if (sound_name.value.indexOf('ogg') != -1) {
                alert('Las operaciones ya están disponibles de manera gráfica. \n Puede oirlas dando click al botón "Leer Ecuación"')
            }
        }else if(document.getElementById("ta_latex").value != '' && sound_name == null){
            alert('No se pudo convertir la ecuación, \n Por favor verifique lo que ingreso e inténtelo nuevamente')
        }
    }

    function setfunction(val){
        input_ta = document.getElementById("ta_latex");
        startPos = input_ta.selectionStart;
        console.log(startPos);
        f_part = input_ta.value.substring(0, startPos);
        s_part = input_ta.value.substring(startPos);
        console.log(f_part);
        console.log(s_part);
        input_ta.value = f_part + val.getAttribute("latexval") + s_part;
        input_ta.focus();
        console.log(val.getAttribute("cursorpos") + startPos);
        input_ta.selectionEnd = parseInt(val.getAttribute("cursorpos")) + startPos;
    }
</script>
</html>
